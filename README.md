# Self Managed ArgoCD

# Requirements
You need to have this installed before try to configure argo
- [K3s](https://k3s.io/)
- Any compatible CRI Runtime
- [Kubectl](https://kubernetes.io/es/docs/reference/kubectl/)
- [Age + SOPS](https://gist.github.com/willbicks/39e1292365cb512cfeab49fe764d7a02)
- [Cert Manager](https://cert-manager.io/) (optional)
- Redis secret created using SOPS

# Usage

Once the SOPS operator is deployed, you can create SopsSecrets whose data and stringData fields are encrypted with the operator's pubic key (modify the .sops.yaml file).

When encrypting resources, SOPS can either be configured with command line flags, or with a .sops.yaml file (per the SOPS docs). The following example uses a .sops.yaml file to configure SOPS to encrypt Kubernetes secret fields with Age and the public key generated above.

```bash
# .sops.yaml
creation_rules:
  - path_regex: \.yaml$
    encrypted_regex: ^(data|stringData)$
    # The following key is the public key generated by the above script. Any additional developers who 
    # should be able to decrypt and edit the file can also have their public keys added here, but 
    # doing so is not required for "sealed secrets" one-way encryption functionality.
    age: 'your_age_public_key'
````

Now, you can create a secret with an `auth` attribute wich will be used for redis like in the example below:

```bash
sops --encrypt --in-place base/argo-cd-redis-secret.yaml
```

With this configuration created, you can now run the following command on the root level:
```bash
kubectl apply -k .
```

After a few second you will see everything up and running.